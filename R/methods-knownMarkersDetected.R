#' Known Markers Detected
#'
#' @rdname knownMarkersDetected
#' @name knownMarkersDetected
#'
#' @param object All markers [data.frame] generated by
#'   [Seurat::FindAllMarkers()].
#' @param knownMarkers Known markers imported by [readKnownMarkers()].
#' @param show Show [kable].
#'
#' @return [tibble].
NULL



# Constructors ====
.knownMarkersDetected <- function(object, knownMarkers, show = FALSE) {
    markers <- .groupMarkers(object) %>%
        left_join(knownMarkers, by = "symbol") %>%
        tidy_select(c("cellType", "symbol", "ensgene", "cluster"),
                    everything()) %>%
        .[!is.na(.[["cellType"]]), ] %>%
        .[order(.[["cellType"]],
                .[["symbol"]],
                .[["pVal"]],
                .[["avgDiff"]],
                decreasing = c(FALSE, FALSE, FALSE, TRUE)), ] %>%
        group_by(!!sym("cellType"))
    if (isTRUE(show)) {
        kable(markers, caption = "Known markers detected") %>% show
    }
    markers
}



# Methods ====
#' @rdname knownMarkersDetected
#' @export
setMethod(
    "knownMarkersDetected",
    signature(object = "data.frame", knownMarkers = "tbl_df"),
    .knownMarkersDetected)
